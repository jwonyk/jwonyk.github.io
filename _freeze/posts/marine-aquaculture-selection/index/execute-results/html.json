{
  "hash": "5f38bae78bd06cc48f3999e25e60c13b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Marine Aquaculture Suitability Analysis\"\ndate: 2025-12-06\ncategories: [MEDS, R]\nimage: aquaculture.jpg\nformat: \n  html:\n    embed-resources: true\n    standalone: true\n    toc: true\nbibliography: references.bib\ncitation:\n  url: \"https://jwonyk.github.io/posts/marine-aquaculture-selection\"\n---\n**Github Repository**: https://github.com/jwonyk/marine-aquaculture-selection\n\n## Introduction\n\nThe growth of marine aquaculture has increased the need for spatial analyses that help identify where different species are most likely to thrive. For shellfish farmers, selecting suitable offshore locations is crucial, which entails determining the proper environmental conditions, such as temperature and depth, that strongly influence survival, growth, overall yield potential, and understanding how to support more sustainable development. This analysis addresses the question:\n\n**Which U.S. West Coast EEZ regions provide the most suitable environmental conditions for oyster and mussel aquaculture based on sea surface temperature (SST) and depth?**\n\n## Set up\nWe are going to clear the environment and load necessary packages.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Clear environment and load required packages\nrm(list = ls())\npacman::p_load(tidyverse, sf, here, \n               terra, stars, tmap, units,\n               ggplot2, viridisLite, dplyr, testthat,\n               janitor, knitr, kableExtra, paletteer)\n```\n:::\n\n\n## Data Preparation\nReading in SST and depth rasters, then check coordinate reference systems (CRS) so that spatial layers align correctly for later operations.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Assign file into lists for average annual sea surface temperature (08-12)\nsst_files <- list.files(here(\"posts\", \"marine-aquaculture-selection\", \"data\"), \n                      pattern = \"average_annual_sst_\", \n                      full.names = TRUE)\n\n# Check to make sure all SST files are loading\nif(length(sst_files) != 5) {\n  \n  stop(\"Fatal error. Please check the file names or path.\")\n  \n} \n\n# Read in raster objects and shapefile\neez <- st_read(here(\"posts\", \"marine-aquaculture-selection\", \"data\", \n                    \"wc_regions_clean\", \"wc_regions_clean.shp\"), \n               quiet = TRUE)\ndepth_rast <- rast(here(\"posts\", \"marine-aquaculture-selection\", \n                        \"data\", \"depth.tif\"))\nsst_rast <- rast(sst_files)\n\n\n\n# Align EEZ shapefile CRS to SST CRS\nif(!identical(st_crs(eez), st_crs(sst_rast))) {\n  \n  message(\"EEZ CRS does not match SST CRS! Transforming EEZ to match SST.\")\n  eez <- st_transform(eez, st_crs(sst_rast))\n  \n} else {\n  \n  message(\"EEZ CRS matches SST CRS.\")\n  \n}\n\n# Match depth raster to SST CRS using `project()`\nif(!crs(depth_rast) == crs(sst_rast)) {\n  \n  message(\"Depth CRS does not match SST CRS! Projecting depth raster.\")\n  depth_rast <- project(depth_rast, sst_rast, method = \"near\")\n  \n} else {\n  \n  message(\"Depth CRS matches SST CRS.\")\n  \n}\n```\n:::\n\n## Compute Mean SST and Convert to Celsius\nBecause SST data span multiple years, we average the rasters to obtain a mean temperature surface, which is then converted from Kelvin to Celsius.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get the average of SST in Kelvin ()\nsst_mean_kelvin <- mean(sst_rast, na.rm = TRUE)\n\n# Convert the average of SST in Celsius\nsst_mean_celsius <- sst_mean_kelvin - 273.15\n\n# Rename the column to make sure no confusion later\nnames(sst_mean_celsius) <- \"sst_mean_celsius\"\n```\n:::\n\n\n## Align Depth Raster to SST Raster\nThe depth raster must match the SST raster’s resolution and extent to ensure accurate cell-by-cell comparison during suitability calculations.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Align depth raster to SST\ndepth_crop <- crop(depth_rast, sst_mean_celsius)\n\n# Resample to match SST resolution (use the nearest neighbor)\ndepth_resample <- resample(depth_crop, \n                           sst_mean_celsius, \n                           method = \"near\")\n\n# Rename the column to make sure no confusion later\nnames(depth_resample) <- \"depth_resample\"\n\n# Check SST and depth are align\nc(sst_mean_celsius, depth_resample)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nclass       : SpatRaster \nsize        : 480, 408, 2  (nrow, ncol, nlyr)\nresolution  : 0.04166185, 0.04165702  (x, y)\nextent      : -131.9848, -114.9867, 29.99305, 49.98842  (xmin, xmax, ymin, ymax)\ncoord. ref. : lon/lat WGS 84 \nsource(s)   : memory\nnames       : sst_mean_celsius, depth_resample \nmin values  :            4.980,          -5468 \nmax values  :           32.895,           4218 \n```\n\n\n:::\n\n```{.r .cell-code}\ncompareGeom(sst_mean_celsius, depth_resample)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] TRUE\n```\n\n\n:::\n:::\n\n\n## Reclassifying & Combine for Suitability\nWe convert continuous SST values into a binary suitability layer based on oyster temperature thresholds from the literature. Similarly, depth values are reclassified to identify areas within the allowable depth range for oyster growth. Multiplying the two binary layers identifies grid cells that meet both environmental requirements.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Oyster thresholds\noyster_sst_min <- 11\noyster_sst_max <- 30\noyster_depth_min <- -70\noyster_depth_max <- 0\n\n# Reclassify SST suitability\n# 0 = unsuitable & 1 = suitable\noyster_sst_suitable <- lapp(sst_mean_celsius, \n                            fun = function(x)\n                              ifelse(x >= 11 & x <= 30, 1, 0))\n\n\n# Reclassify depth\noyster_depth_suitable <- lapp(depth_resample,\n                              fun = function(x)\n                                ifelse(x >= -70 & x <= 0, 1, 0))\n\n# Combine classified SST and depth by multiplying them both\noyster_cells_suitable <- oyster_sst_suitable * oyster_depth_suitable\n```\n:::\n\n\n## Crop and Mask Suitability to EEZ Boundaries\nWe restrict the area of interest to U.S. West Coast Exclusive Economic Zones (EEZs), ensuring suitability is evaluated only within jurisdictional waters.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Convert EEZ object to SpatVector to use as `terra` ojbect\neez_vector <- vect(eez)\n\n# Crop suitability raster to EEZ bounding box (reduce processing)\noyster_crop <- crop(oyster_cells_suitable, eez_vector)\n\n# Mask cells outside the EEZ\noyster_eez <- mask(oyster_crop, eez_vector)\n```\n:::\n\n\n## Compute Suitable Cells to Area\nEach raster cell’s area is computed and summed within each EEZ to quantify total suitable habitat in square kilometers.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Compute per-cell area (in km^2)\ncell_area_km2 <- cellSize(oyster_eez, unit = \"km\")\n\n# Multiply area raster by suitable, 0 vs 1, only return suitable cells\noyster_area <- oyster_eez * cell_area_km2\n\n# Rename the column to make sure no confusion later\nnames(oyster_area) <- \"suitable_area_km2\"\n```\n:::\n\n\n## Join Suitability Results to EEZ Polygons\nWe join calculated suitable area values back to EEZ polygons so they can be visualized on a choropleth map.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Rename ID column to easier access\neez <- eez %>% \n  rename(eez_id = rgn_id)\n\n# Convert into SpatVector after name update\neez_vector <- vect(eez)\n\n# Rasterize EEZ polygons to match raster grid before `zonal()`\neez_id_raster <- rasterize(eez_vector, oyster_area, field = \"eez_id\")\n```\n:::\n\n\n## Calculate and Summarize Suitable Area by EEZ\nWe sum all suitable raster cells within each EEZ and join these results to the EEZ polygons.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Add up suitable area within each EEZ zone\noyster_area_eez <- zonal(oyster_area, eez_id_raster,\n                         fun = \"sum\",\n                         na.rm = TRUE) %>% \n  as.data.frame()\n\n# Join with EEZ polygons for mapping purposes\neez_oyster_join <- eez %>% \n  left_join(oyster_area_eez, by = \"eez_id\")\n\n# Create table of suitable area ranked by EEZ\neez_oyster_join %>% \n  st_drop_geometry() %>% \n  arrange(desc(suitable_area_km2)) %>% \n  kable(\"html\", \n        caption = \"Suitable Oyster Habitat Area by EEZ (km^2)\",\n        align = \"c\") %>% \n  kable_styling(full_width = FALSE, \n                bootstrap_options = c(\"striped\", \"hover\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<caption>Suitable Oyster Habitat Area by EEZ (km^2)</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:center;\"> rgn </th>\n   <th style=\"text-align:center;\"> rgn_key </th>\n   <th style=\"text-align:center;\"> area_m2 </th>\n   <th style=\"text-align:center;\"> eez_id </th>\n   <th style=\"text-align:center;\"> area_km2 </th>\n   <th style=\"text-align:center;\"> suitable_area_km2 </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:center;\"> Central California </td>\n   <td style=\"text-align:center;\"> CA-C </td>\n   <td style=\"text-align:center;\"> 202738329147 </td>\n   <td style=\"text-align:center;\"> 3 </td>\n   <td style=\"text-align:center;\"> 202738.33 </td>\n   <td style=\"text-align:center;\"> 4940.0422 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> Southern California </td>\n   <td style=\"text-align:center;\"> CA-S </td>\n   <td style=\"text-align:center;\"> 206860777840 </td>\n   <td style=\"text-align:center;\"> 4 </td>\n   <td style=\"text-align:center;\"> 206860.78 </td>\n   <td style=\"text-align:center;\"> 4221.3919 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> Washington </td>\n   <td style=\"text-align:center;\"> WA </td>\n   <td style=\"text-align:center;\"> 66898309678 </td>\n   <td style=\"text-align:center;\"> 5 </td>\n   <td style=\"text-align:center;\"> 66898.31 </td>\n   <td style=\"text-align:center;\"> 3313.1592 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> Oregon </td>\n   <td style=\"text-align:center;\"> OR </td>\n   <td style=\"text-align:center;\"> 179994061293 </td>\n   <td style=\"text-align:center;\"> 1 </td>\n   <td style=\"text-align:center;\"> 179994.06 </td>\n   <td style=\"text-align:center;\"> 1578.9688 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> Northern California </td>\n   <td style=\"text-align:center;\"> CA-N </td>\n   <td style=\"text-align:center;\"> 164378809215 </td>\n   <td style=\"text-align:center;\"> 2 </td>\n   <td style=\"text-align:center;\"> 164378.81 </td>\n   <td style=\"text-align:center;\"> 454.2957 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n## Map Oyster Aquaculture Suitability\nA map is generated showing the relative availability of suitable habitat across EEZs, providing spatial insights for marine planning.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Make sure to initialize \"plot\" mode for static render\ntmap_mode(\"plot\")\n\n# Extract paleteer colors\nteal_palette <- as.character(paletteer_d(\"ggsci::teal_material\"))\neez_map <- eez_oyster_join[!is.na(eez_oyster_join$suitable_area_km2), ]\n\n# Map suitable area by EEZ\ntm_tiles(\"Esri.OceanBasemap\") +\ntm_shape(eez_map) + \n  tm_polygons(\n    col = \"suitable_area_km2\",\n    palette = colorRampPalette(teal_palette)(5),\n    title = \"Suitable Area (km^2)\",\n    showNA = FALSE) +\n  tm_layout(main.title = \"Oyster Aquaculture Suitability by EEZ\",\n            main.title.size = 1, \n            frame = FALSE,\n            legend.outside = TRUE,\n            legend.outside.position = \"right\",\n            outer.margins = c(0, 0, 0, 0),\n            inner.margins = c(0, 0, 0, 0.02)) +\n  tm_compass(position = c(\"right\", \"top\")) +\n  tm_scalebar(breaks = c(0, 100, 200, 300),\n              position = c(\"left\", \"bottom\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/map-zonal-area-1.png){width=672}\n:::\n:::\n\n\n## Reflection - Oyster Aquaculture Suitability\n\nThe oyster aquaculture sustainability analysis demonstrates how combining raster-based environmental data with vector-based EEZ boundaries can show spatial patterns relevant to marine resource planning. By averaging five years of SST data and re-sampling bathymetry, I was able to evaluate habitat suitability with thresholds from the literature. The reclassification and raster algebra workflow made it clear how sensitive spatial outputs are. It needs multiple checking and reassigning to make sure everything can be processed normally. The warmer southern regions has larger areas of meeting oyster depth and temperature requirements than northern parts.\n\n## Apply Workflow Function\n\nTo show generalizability, the suitability workflow is applied to another species with different environmental thresholds.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# General Function to calculate aquaculture suitability\n\ncompute_suitability <- function(sst_min, sst_max,\n                                depth_min, depth_max,\n                                species_name) {\n  \n# 1. Reclassify SST\nsst_suitable <- lapp(sst_mean_celsius,\n                     fun = function(x) \n                       ifelse(x >= sst_min & x <= sst_max, 1, 0))\n\n# 2. Reclassify Depth\ndepth_suitable <- lapp(depth_resample,\n                       fun = function(x) \n                         ifelse(x >= depth_min & x <= depth_max, 1, 0))\n\n# 3. Combine Suitability\nsuitable_cells <- sst_suitable * depth_suitable\n\n# 4. Crop and Mask to EEZ\nsuitable_crop <- crop(suitable_cells, eez_vector)\nsuitable_eez <- mask(suitable_crop, eez_vector)\n\n# 5. Convert Suitability to Area in km^2\ncell_area <- cellSize(suitable_eez, unit = \"km\")\nsuitable_area <- suitable_eez * cell_area\nnames(suitable_area) <- \"suitable_area_km2\"\n\n# 6. Rasterize EEZ and Compute Zonal Area\neez_id_raster <- rasterize(eez_vector, suitable_area, field = \"eez_id\")\n\nzone_df <- zonal(suitable_area, eez_id_raster,\n                 fun = \"sum\", na.rm = TRUE) %>% \n  as.data.frame()\n\n# 7. Join results\neez_join <- eez %>% \n  left_join(zone_df, by = \"eez_id\")\n\n# 8. Map\nteal_palette <- as.character(paletteer_d(\"ggsci::teal_material\"))\n\nmap <- tm_tiles(\"Esri.OceanBasemap\") +\n  tm_shape(eez_join) +\n    tm_polygons(col = \"suitable_area_km2\",\n                palette = colorRampPalette(teal_palette)(20),\n                title = \"Suitable Area (km²)\") +\n    tm_layout(main.title = paste(\"Aquaculture Suitability for\",\n                                 species_name),\n              main.title.size = 1.0,\n              legend.outside = TRUE,\n              frame = FALSE) +\n    tm_compass(position = c(\"right\", \"top\")) +\n    tm_scalebar(breaks = c(0, 100, 200, 300),\n                position = c(\"left\", \"bottom\"))\nreturn(map)}\n```\n:::\n\n\n## Map Mussel Aquaculture Suitability\n\nA map is generated showing the relative availability of suitable habitat across EEZs, providing spatial insights for marine planning.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# SST 9 to 18 degrees Celsius, depth 0 to 20 meters\nmussle_map <- compute_suitability(\n  sst_min = 9,\n  sst_max = 18,\n  depth_min = -20,\n  depth_max = 0,\n  species_name = \"Mussels (A. californiensis)\")\n\nmussle_map\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/mussel-results-1.png){width=672}\n:::\n:::\n\n\n## Reflection - Mussel Aquaculture Suitability\n\nThe mussel suitability assessment shows different spatial patterns compare to oysters, emphasizing how species-specific environmental requirements could lead to different aquaculture potential across EEZs. Mussels favor cooler temperature and shallow depths and shows that more suitable northward than southern regions - sustainability is highest in Northern California and Washington.\n\n## Conclusion\n\nThis analysis demonstrates how we use spatial data science to evaluate the sustainability of aquaculture across large marine regions. By combining sea surface temperature data, bathymetry, raster reclassification, and Zonal statistics, we can identify locations that hit all the requirements for the environmental conditions specific to the aquaculture species. The results show that oysters prefer the warm southern waters, whereas mussels are better suited to the cooler northern regions of EEZs. The findings could improve productivity and reduce ecological risks.\n\n## Future Directions\n\nThese are the limitations that we need to include in our future analysis:\n\n**Environmental variables**: Suitability should depend on more than sea surface temperature and depth. We may also need information such as chlorophyll concentration, salinity, ocean currents, and wave exposure.\n\n**Socioeconomic Aspects**: Not all environmentally suitable areas are socially, economically, and legally feasible for farmers.",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}